<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Positive definite matrices — correct_positive_definite • LTFHPlus</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/darkly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Positive definite matrices — correct_positive_definite"><meta property="og:description" content="correct_positive_definite verifies that a given covariance matrix
is indeed positive definite by checking that all eigenvalues are positive.
If the given covariance matrix is not positive definite,
correct_positive_definite tries to modify the underlying correlation matrices
genetic_corrmat and full_corrmat in order to obtain a positive definite
covariance matrix."><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LTFHPlus</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">2.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/LTFHPlus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FromCIPFamilyToLTFHPlusInput.html">From CIP and family to LT-FH++ input</a>
    </li>
    <li>
      <a href="../articles/FromTrioToFamilies.html">From trio information to full families</a>
    </li>
    <li>
      <a href="../articles/LTFHPlusExample.html">LT-FH++ Example</a>
    </li>
    <li>
      <a href="../articles/LTFHPlusGraphExample.html">LT-FH++ Graph Example</a>
    </li>
    <li>
      <a href="../articles/inputFormatExample.html">How the covariance is constructed</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/EmilMiP/LTFHPlus/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Positive definite matrices</h1>
    <small class="dont-index">Source: <a href="https://github.com/EmilMiP/LTFHPlus/blob/HEAD/R/Helper_functions.R" class="external-link"><code>R/Helper_functions.R</code></a></small>
    <div class="hidden name"><code>correct_positive_definite.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>correct_positive_definite</code> verifies that a given covariance matrix
is indeed positive definite by checking that all eigenvalues are positive.
If the given covariance matrix is not positive definite,
<code>correct_positive_definite</code> tries to modify the underlying correlation matrices
genetic_corrmat and full_corrmat in order to obtain a positive definite
covariance matrix.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">correct_positive_definite</span><span class="op">(</span></span>
<span>  <span class="va">covmat</span>,</span>
<span>  correction_val <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  correction_limit <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>covmat</dt>
<dd><p>A symmetric and numeric matrix. If the covariance matrix
should be corrected, it must have a number of attributes, such as
<code>attr(covmat,"fam_vec")</code>, <code>attr(covmat,"n_fam")</code>,
<code>attr(covmat,"add_ind")</code>, <code>attr(covmat,"h2")</code>,
<code>attr(covmat,"genetic_corrmat")</code>, <code>attr(covmat,"full_corrmat")</code>
and <code>attr(covmat,"phenotype_names")</code>. Any covariance matrix
obtained by <code><a href="construct_covmat.html">construct_covmat</a></code>, <code><a href="construct_covmat_single.html">construct_covmat_single</a></code>
or <code><a href="construct_covmat_multi.html">construct_covmat_multi</a></code> will have these attributes by default.</p></dd>


<dt>correction_val</dt>
<dd><p>A positive number representing the amount by which
<code>genetic_corrmat</code> and <code>full_corrmat</code> will be changed, if some
eigenvalues are non-positive. That is, correction_val is the number that will be
multiplied to all off_diagonal entries in <code>genetic_corrmat</code> and <code>full_corrmat</code>.
Defaults to 0.99.</p></dd>


<dt>correction_limit</dt>
<dd><p>A positive integer representing the upper limit for the correction
procedure. Defaults to 100.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>If <code>covmat</code> is a symmetric and numeric matrix and all eigenvalues are
positive, <code>correct_positive_definite</code> simply returns <code>covmat</code>. If some
eigenvalues are not positive and <code>correction_val</code> is a positive number,
<code>correct_positive_definite</code> tries to convert <code>covmat</code> into a positive definite
matrix. If <code>covmat</code> has attributes <code>add_ind</code>, <code>h2</code>,
<code>genetic_corrmat</code>, <code>full_corrmat</code> and <code>phenotype_names</code>,
<code>correct_positive_definite</code> computes a new covariance matrix using slightly
modified correlation matrices <code>genetic_corrmat</code> and <code>full_corrmat</code>.
If the correction is performed successfully, i.e. if the new covariance matrix
is positive definite,the new covariance matrix is returned.
Otherwise, <code>correct_positive_definite</code> returns the original covariance matrix.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function can be used to verify that a given covariance matrix
is positive definite. It calculates all eigenvalues in order to
investigate whether they are all positive. This property is necessary
for the covariance matrix to be used as a Gaussian covariance matrix.
It is especially useful to check whether any covariance matrix obtained
by <code><a href="construct_covmat_multi.html">construct_covmat_multi</a></code> is positive definite.
If the given covariance matrix is not positive definite, <code>correct_positive_definite</code>
tries to modify the underlying correlation matrices (called <code>genetic_corrmat</code> and
<code>full_corrmat</code> in <code><a href="construct_covmat.html">construct_covmat</a></code> or <code><a href="construct_covmat_multi.html">construct_covmat_multi</a></code>) by
multiplying all off-diagonal entries in the correlation matrices by a given number.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="construct_covmat.html">construct_covmat</a></code>, <code><a href="construct_covmat_single.html">construct_covmat_single</a></code> and
<code><a href="construct_covmat_multi.html">construct_covmat_multi</a></code>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">ntrait</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">genetic_corrmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.6</span>, ncol <span class="op">=</span> <span class="va">ntrait</span>, nrow <span class="op">=</span> <span class="va">ntrait</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">genetic_corrmat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">full_corrmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.25</span>, ncol <span class="op">=</span> <span class="va">ntrait</span>, nrow <span class="op">=</span> <span class="va">ntrait</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">full_corrmat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">h2_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="va">ntrait</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="construct_covmat.html">construct_covmat</a></span><span class="op">(</span>fam_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"f"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  genetic_corrmat <span class="op">=</span> <span class="va">genetic_corrmat</span>,</span></span>
<span class="r-in"><span>  h2 <span class="op">=</span> <span class="va">h2_vec</span>,</span></span>
<span class="r-in"><span>  full_corrmat <span class="op">=</span> <span class="va">full_corrmat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cov</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              g_phenotype1 o_phenotype1 m_phenotype1 f_phenotype1 g_phenotype2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype1         0.60         0.60         0.30         0.30         0.36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype1         0.60         1.00         0.30         0.30         0.36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype1         0.30         0.30         1.00         0.00         0.18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype1         0.30         0.30         0.00         1.00         0.18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype2         0.36         0.36         0.18         0.18         0.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype2         0.36        -0.25         0.18         0.18         0.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype2         0.18         0.18        -0.25         0.00         0.30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype2         0.18         0.18         0.00        -0.25         0.30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              o_phenotype2 m_phenotype2 f_phenotype2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype1         0.36         0.18         0.18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype1        -0.25         0.18         0.18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype1         0.18        -0.25         0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype1         0.18         0.00        -0.25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype2         0.60         0.30         0.30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype2         1.00         0.30         0.30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype2         0.30         1.00         0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype2         0.30         0.00         1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"fam_vec")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "g" "o" "m" "f"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"n_fam")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f g m o </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1 1 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"add_ind")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"h2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6 0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"genetic_corrmat")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.0  0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.6  1.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"full_corrmat")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       [,1]  [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.00 -0.25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.25  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"phenotype_names")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "phenotype1" "phenotype2"</span>
<span class="r-in"><span><span class="fu">correct_positive_definite</span><span class="op">(</span><span class="va">cov</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The specified covariance matrix is not positive definite. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Trying to correct the covariance matrix...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The correction was performed successfully! All off-diagonal entries are corrected by0.656.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              g_phenotype1 o_phenotype1 m_phenotype1 f_phenotype1 g_phenotype2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype1    0.6000000    0.6000000    0.3000000    0.3000000    0.2360373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype1    0.6000000    1.0000000    0.3000000    0.3000000    0.2360373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype1    0.3000000    0.3000000    1.0000000    0.0000000    0.1180187</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype1    0.3000000    0.3000000    0.0000000    1.0000000    0.1180187</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype2    0.2360373    0.2360373    0.1180187    0.1180187    0.6000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype2    0.2360373   -0.1639148    0.1180187    0.1180187    0.6000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype2    0.1180187    0.1180187   -0.1639148    0.0000000    0.3000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype2    0.1180187    0.1180187    0.0000000   -0.1639148    0.3000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              o_phenotype2 m_phenotype2 f_phenotype2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype1    0.2360373    0.1180187    0.1180187</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype1   -0.1639148    0.1180187    0.1180187</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype1    0.1180187   -0.1639148    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype1    0.1180187    0.0000000   -0.1639148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g_phenotype2    0.6000000    0.3000000    0.3000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> o_phenotype2    1.0000000    0.3000000    0.3000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m_phenotype2    0.3000000    1.0000000    0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_phenotype2    0.3000000    0.0000000    1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"fam_vec")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "g" "o" "m" "f"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"n_fam")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f g m o </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1 1 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"add_ind")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"h2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6 0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"genetic_corrmat")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1.0000000 0.3933955</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.3933955 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"full_corrmat")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]       [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.0000000 -0.1639148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -0.1639148  1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"phenotype_names")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "phenotype1" "phenotype2"</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Emil Michael Pedersen, Florian Privé, Jette Steinbach.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

