<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LT-FH++ Example • LTFHPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/darkly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="LT-FH++ Example">
<meta property="og:description" content="LTFHPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LTFHPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/LTFHPlus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/inputFormatExample.html">Input Format</a>
    </li>
    <li>
      <a href="../articles/LTFHPlusExample.html">LT-FH++ Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EmilMiP/LTFHPlus/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>LT-FH++ Example</h1>
                        <h4 data-toc-skip class="author">Emil M.
Pedersen</h4>
            
            <h4 data-toc-skip class="date">5/7/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EmilMiP/LTFHPlus/blob/HEAD/vignettes/LTFHPlusExample.Rmd" class="external-link"><code>vignettes/LTFHPlusExample.Rmd</code></a></small>
      <div class="hidden name"><code>LTFHPlusExample.Rmd</code></div>

    </div>

    
    
<p>First, we will load the packages that we will need for the
example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EmilMiP/LTFHPlus" class="external-link">LTFHPlus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="global-parameters">Global parameters<a class="anchor" aria-label="anchor" href="#global-parameters"></a>
</h3>
<p>The strategy from here is to generate the necessary information for
each individual in the example. We will start out by setting some global
parameters:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">=</span> <span class="fl">100</span> <span class="co">#number of individuals</span>
<span class="va">h2</span> <span class="op">=</span> <span class="fl">.5</span> <span class="co">#heritability</span>
<span class="va">nsib</span> <span class="op">=</span> <span class="fl">2</span> <span class="co">#number of siblings</span>

<span class="co">#calculates the sex-specific prevalences used to determine status:</span>
<span class="va">multiplier</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">prev</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="fl">0.02</span><span class="op">)</span> <span class="op">*</span> <span class="va">multiplier</span>

<span class="va">nthreads</span> <span class="op">=</span> <span class="fl">5</span>  <span class="co"># number of threads to use for LT-FH++</span></code></pre></div>
<p>It is worth noting that these values can be set more or less anything
the reader would want/need. Our choice of prevalence vector is to
illustrate LT-FH++’s ability to estimate the genetic liability, even
when the cases are not equally distributed between the sexes. Other
prevalence vectors could be used, for instance one with the same
prevalence between sexes.</p>
</div>
<div class="section level3">
<h3 id="setting-up-input">Setting up input<a class="anchor" aria-label="anchor" href="#setting-up-input"></a>
</h3>
<p>LT-FH++ requires 3 types of input, name <strong>h2</strong>,
<strong>phen</strong>, and <strong>thr</strong>, which is the
heritability on liability scale, a list of ids (where each list entry is
a family), and finally the upper and lower limit for each individual
used by the truncated normal in LT-FH++.</p>
<p>With the global parameters set, we will simulate the liabilities for
each family member based on the multivariate normal described in the
[LT-FH++] paper. Next, we assign ages to each individual. The child’s
age act as a baseline age, and the age of parents and siblings are
determined based off of the child’s age.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#simulate liabilities</span>
<span class="va">liabs</span> <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span> <span class="op">+</span> <span class="va">nsib</span><span class="op">)</span>,
                      Sigma <span class="op">=</span> <span class="fu"><a href="../reference/construct_covmat.html">construct_covmat</a></span><span class="op">(</span>fam_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"f"</span>, <span class="kw">if</span> <span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nsib</span><span class="op">)</span><span class="op">)</span>,
                                               h2 <span class="op">=</span> <span class="va">h2</span><span class="op">)</span>
                      <span class="op">)</span>

<span class="co">#Age of children, parents, and siblings</span>
<span class="va">child_age</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">15</span>, <span class="fl">60</span><span class="op">)</span>
<span class="va">father_age</span>  <span class="op">=</span> <span class="va">child_age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">20</span>, <span class="fl">35</span><span class="op">)</span>
<span class="va">mother_age</span>  <span class="op">=</span> <span class="va">child_age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">20</span>, <span class="fl">35</span><span class="op">)</span>
<span class="va">children_sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sibling_sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">nsib</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="va">sibling_age</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">nsib</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="va">child_age</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level4">
<h4 id="generating-phen">Generating phen<a class="anchor" aria-label="anchor" href="#generating-phen"></a>
</h4>
<p>Next, we want to assign sex, status, age-of-onset(aoo) to each
individual, including the family members.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Constructing tibble with list entries,</span>
<span class="co"># each row is a family. assuming order: os, father, mother, siblings (if any)</span>
<span class="va">phen</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
  <span class="co">#get full liabilities of all family members</span>
  <span class="va">cur_liabs</span>  <span class="op">=</span> <span class="va">liabs</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">4</span> <span class="op">+</span> <span class="va">nsib</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> 
  <span class="co"># assign ids</span>
  <span class="va">id_vec</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i</span> , <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_f"</span>, <span class="st">"_m"</span><span class="op">)</span><span class="op">)</span>, <span class="kw">if</span><span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_s"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nsib</span><span class="op">)</span> <span class="op">)</span> 
  <span class="co">#assign sex</span>
  <span class="va">sex_vec</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">children_sex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="kw">if</span><span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">sibling_sex</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span> 
  <span class="co"># assign age</span>
  <span class="va">age_vec</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">child_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">father_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">mother_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="kw">if</span> <span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">sibling_age</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span> 
  <span class="co"># assign status</span>
  <span class="va">status_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sex_vec</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ii</span><span class="op">)</span> <span class="op">{</span> 
    <span class="op">(</span><span class="va">cur_liabs</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">prev</span><span class="op">[</span><span class="va">sex_vec</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0L</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="co">#assign age-of-onset for cases</span>
  <span class="va">aoo_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">id_vec</span><span class="op">)</span><span class="op">)</span> 
  
  <span class="va">cases</span> <span class="op">=</span> <span class="va">status_vec</span> <span class="op">==</span> <span class="fl">1</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">aoo_vec</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="../reference/convert_liability_to_aoo.html">convert_liability_to_aoo</a></span><span class="op">(</span>liability <span class="op">=</span> <span class="va">cur_liabs</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span>,
                                                   pop_prev <span class="op">=</span> <span class="va">prev</span><span class="op">[</span><span class="va">sex_vec</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                          <span class="fl">4</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="co">#return information</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">id_vec</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sex_vec</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">status_vec</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">age_vec</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">aoo_vec</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">.</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co">#outputs list, combining with rbind </span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>.name_repair <span class="op">=</span> <span class="st">'unique'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># converting to tibble</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"ids"</span> <span class="op">=</span> <span class="st">"...1"</span>,
         <span class="st">"sex"</span> <span class="op">=</span> <span class="st">"...2"</span>, 
         <span class="st">"status"</span> <span class="op">=</span> <span class="st">"...3"</span>, 
         <span class="st">"age"</span> <span class="op">=</span> <span class="st">"...4"</span>, 
         <span class="st">"aoo"</span> <span class="op">=</span> <span class="st">"...5"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># renaming columns</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 100 x 5</span></span>
<span class="co">##    ids       sex       status    age       aoo      </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;chr [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> <span style="color: #949494;">&lt;dbl [5]&gt;</span> <span style="color: #949494;">&lt;lgl [5]&gt;</span></span>
<span class="co">## <span style="color: #949494;"># ... with 90 more rows</span></span></code></pre>
<p>The output is a tibble with list entries, meaning each row is a
family in the order of child, father, mother, and siblings (if any).
This keeps all relevant information for each family accessible in an
easy manner for processing later on. Each family can be easily accessed,
e.g.:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phen</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">phen</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 5 x 5</span></span>
<span class="co">##   ids     sex status   age aoo  </span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 1         2      0  46.4 <span style="color: #BB0000;">NA</span>   </span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 1_f       1      0  75.7 <span style="color: #BB0000;">NA</span>   </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 1_m       2      0  72.4 <span style="color: #BB0000;">NA</span>   </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 1_s1      1      0  40.5 <span style="color: #BB0000;">NA</span>   </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 1_s2      2      0  34.5 <span style="color: #BB0000;">NA</span></span></code></pre>
<p>Since we expect the family sizes to vary between families and we
wanted to accomodate this, we found it simplest to work with lists or
tibbles with list entries. This means the <strong>phen</strong> input,
which is the first input, is simply the <em>ids</em> column from
<em>phen</em>.</p>
</div>
<div class="section level4">
<h4 id="generating-thr">Generating thr<a class="anchor" aria-label="anchor" href="#generating-thr"></a>
</h4>
<p>The other input is <strong>thr</strong>, which will contain the ids
and an upper and lower limit of possible liabilities for each
individual.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#assigning thresholds for each family</span>
<span class="va">thr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">phen</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">ids</span>   <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">ids</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span>
  <span class="va">cases</span> <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">status</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span>
  <span class="va">lower</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span>
  <span class="va">upper</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span> <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">lower</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">upper</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_age_to_thresh.html">convert_age_to_thresh</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">aoo</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span>, 
                                                          pop_prev <span class="op">=</span> <span class="va">prev</span><span class="op">[</span><span class="va">phen</span><span class="op">$</span><span class="va">sex</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">upper</span><span class="op">[</span><span class="op">!</span><span class="va">cases</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_age_to_thresh.html">convert_age_to_thresh</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">age</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">cases</span><span class="op">]</span>,
                                         pop_prev <span class="op">=</span> <span class="va">prev</span><span class="op">[</span><span class="va">phen</span><span class="op">$</span><span class="va">sex</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">cases</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">res</span><span class="op">$</span><span class="va">ids</span> <span class="op">=</span> <span class="va">ids</span>
  <span class="va">res</span><span class="op">$</span><span class="va">lower</span> <span class="op">=</span> <span class="va">lower</span>
  <span class="va">res</span><span class="op">$</span><span class="va">upper</span> <span class="op">=</span> <span class="va">upper</span>
  <span class="va">res</span>
<span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">as_tibble</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 500 x 3</span></span>
<span class="co">##    ids   lower upper</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> 1      -<span style="color: #BB0000;">Inf</span>  2.74</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> 1_f    -<span style="color: #BB0000;">Inf</span>  1.47</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> 1_m    -<span style="color: #BB0000;">Inf</span>  2.13</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> 1_s1   -<span style="color: #BB0000;">Inf</span>  2.49</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> 1_s2   -<span style="color: #BB0000;">Inf</span>  3.16</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> 2      -<span style="color: #BB0000;">Inf</span>  2.03</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 2_f    -<span style="color: #BB0000;">Inf</span>  1.47</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 2_m    -<span style="color: #BB0000;">Inf</span>  2.14</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 2_s1   -<span style="color: #BB0000;">Inf</span>  2.30</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 2_s2   -<span style="color: #BB0000;">Inf</span>  1.69</span>
<span class="co">## <span style="color: #949494;"># ... with 490 more rows</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="running-lt-fh">Running LT-FH++<a class="anchor" aria-label="anchor" href="#running-lt-fh"></a>
</h3>
<p>With all input parameters generated and the heritability set in the
global settings, we have everything we need to run <em>LT-FH++</em>. The
package <strong>Future.apply</strong> can be used to parallelize the
computations for LT-FH++, and we highly recommend doing this, since all
modern computers have more than 2 cores available to them. The future
framework also allows for easy use on high performance computing (HPC)
clusters. In this example, we will utilize 5 threads.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phen</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">phen</span>, <span class="va">ids</span><span class="op">)</span>

<span class="co">#Setting up parallelization backend</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://future.futureverse.org/reference/tweak.html" class="external-link">tweak</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="va">nthreads</span><span class="op">)</span><span class="op">)</span>
<span class="co">#performs LT-FH++ analysis</span>
<span class="va">simu_liab</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimate_gen_liability.html">estimate_gen_liability</a></span><span class="op">(</span>h2 <span class="op">=</span> <span class="va">h2</span>,
                       phen <span class="op">=</span> <span class="va">phen</span>,
                       thr <span class="op">=</span> <span class="va">thr</span>,
                       id_col <span class="op">=</span> <span class="st">"ids"</span><span class="op">)</span>
<span class="va">simu_liab</span> <span class="op">=</span> <span class="va">simu_liab</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ids</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 100 x 3</span></span>
<span class="co">##    ids   post_gen_liab post_gen_liab_se</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> 1           -<span style="color: #BB0000;">0.055</span><span style="color: #BB0000; text-decoration: underline;">3</span>          0.004<span style="text-decoration: underline;">35</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> 2           -<span style="color: #BB0000;">0.089</span><span style="color: #BB0000; text-decoration: underline;">5</span>          0.003<span style="text-decoration: underline;">97</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> 3           -<span style="color: #BB0000;">0.046</span><span style="color: #BB0000; text-decoration: underline;">9</span>          0.004<span style="text-decoration: underline;">14</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> 4           -<span style="color: #BB0000;">0.028</span><span style="color: #BB0000; text-decoration: underline;">7</span>          0.004<span style="text-decoration: underline;">39</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> 5           -<span style="color: #BB0000;">0.083</span><span style="color: #BB0000; text-decoration: underline;">3</span>          0.003<span style="text-decoration: underline;">79</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> 6           -<span style="color: #BB0000;">0.065</span><span style="color: #BB0000; text-decoration: underline;">0</span>          0.003<span style="text-decoration: underline;">87</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 7            0.380           0.003<span style="text-decoration: underline;">62</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 8           -<span style="color: #BB0000;">0.034</span><span style="color: #BB0000; text-decoration: underline;">7</span>          0.004<span style="text-decoration: underline;">49</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 9           -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">2</span>          0.004<span style="text-decoration: underline;">27</span></span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 10          -<span style="color: #BB0000;">0.038</span><span style="color: #BB0000; text-decoration: underline;">7</span>          0.004<span style="text-decoration: underline;">40</span></span>
<span class="co">## <span style="color: #949494;"># ... with 90 more rows</span></span></code></pre>
<p>From here the object simu_liab can be saved and used in your GWAS
method of choice.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Emil Michael Pedersen, Florian Privé, Jette Steinbach.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
