<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LTFHPlus Multiple Traits Example • LTFHPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/darkly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="LTFHPlus Multiple Traits Example">
<meta property="og:description" content="LTFHPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LTFHPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/LTFHPlus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/LTFHPlusExample.html">LT-FH++ Example</a>
    </li>
    <li>
      <a href="../articles/LTFHPlusExampleMultiTrait.html">LTFHPlus Multiple Traits Example</a>
    </li>
    <li>
      <a href="../articles/LTFHPlusExampleNoFH.html">LT-FH++ Example No Family History</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="LTFHPlusExampleMultiTrait_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>LTFHPlus Multiple Traits Example</h1>
                        <h4 class="author">Emil M. Pedersen</h4>
            
            <h4 class="date">9/7/2021</h4>
      
      
      <div class="hidden name"><code>LTFHPlusExampleMultiTrait.Rmd</code></div>

    </div>

    
    
<p>First, we will load the packages that we will need for the example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">LTFHPlus</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/future.apply">future.apply</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></code></pre></div>
<div id="global-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#global-parameters" class="anchor"></a>Global parameters</h3>
<p>The strategy from here is to generate the necessary information for each individual in the example. We will start out by setting some global parameters:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">=</span> <span class="fl">10000</span> <span class="co">#number of individuals</span>
<span class="va">nsib</span> <span class="op">=</span> <span class="fl">2</span> <span class="co">#number of siblings</span>
<span class="co">#constructing correlation matrix for LT-FH++</span>
<span class="va">h2_1</span> <span class="op">=</span> <span class="fl">.5</span>
<span class="va">h2_2</span> <span class="op">=</span> <span class="fl">.5</span>
<span class="va">gen_cor</span> <span class="op">=</span> <span class="fl">.5</span>
<span class="va">corr_mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">h2_1</span>, <span class="va">h2_2</span><span class="op">)</span><span class="op">)</span>
<span class="va">corr_mat</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">corr_mat</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gen_cor</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">h2_1</span> <span class="op">*</span> <span class="va">h2_2</span><span class="op">)</span>

<span class="co">#calculates the sex-specific prevalences used to determine status:</span>
<span class="va">multiplier</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">prev</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="fl">0.02</span><span class="op">)</span> <span class="op">*</span> <span class="va">multiplier</span>

<span class="va">nthreads</span> <span class="op">=</span> <span class="fl">5</span>  <span class="co"># number of threads to use for LT-FH++</span></code></pre></div>
<p>It is worth noting that these values can be set more or less anything the reader would want/need. Our choice of prevalence vector is to illustrate LT-FH++’s ability to estimate the genetic liability, even when the cases are not equally distributed between the sexes. Other prevalence vectors could be used, for instance one with the same prevalence between sexes. Extensions to the correlation matrix can also be made to include more disorders, or to change the correlations or the heritabilities.</p>
</div>
<div id="setting-up-input" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-input" class="anchor"></a>Setting up input</h3>
<p>LT-FH++ for multiple phenotypes requires 3 types of input, name <strong>corr.mat</strong>, <strong>phen.list</strong>, and <strong>thr.list</strong>, which is the covariance matrix on liability scale, a list of ids (where each list entry is a family), and finally a list of the upper and lower limit for each individual and each trait used by the truncated normal in LT-FH++.</p>
<p>With the global parameters set, we will simulate the liabilities for each family member based on a multivariate normal, which is an extension of the covariance matrix described in the [LT-FH++] paper. Next, we assign ages to each individual. The child’s age act as a baseline age, and the age of parents and siblings are determined based off of the child’s age.</p>
<p>We will be using a covariance matrix to simulate the liabilities for each disorder and each family member that is given by</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#correlation matrix</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span> <span class="fl">100</span><span class="op">*</span> <span class="fu"><a href="../reference/get_full_cov.html">get_full_cov</a></span><span class="op">(</span>corr_mat <span class="op">=</span> <span class="va">corr_mat</span>, n_sib <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>##       [,1]   [,2]   [,3]   [,4]  [,5]   [,6]   [,7]   [,8]
## [1,] 50.00  50.00  25.00  25.00 12.50  12.50   6.25   6.25
## [2,] 50.00 100.00  25.00  25.00 12.50  12.50   6.25   6.25
## [3,] 25.00  25.00 100.00   0.00  6.25   6.25  12.50   0.00
## [4,] 25.00  25.00   0.00 100.00  6.25   6.25   0.00  12.50
## [5,] 12.50  12.50   6.25   6.25 50.00  50.00  25.00  25.00
## [6,] 12.50  12.50   6.25   6.25 50.00 100.00  25.00  25.00
## [7,]  6.25   6.25  12.50   0.00 25.00  25.00 100.00   0.00
## [8,]  6.25   6.25   0.00  12.50 25.00  25.00   0.00 100.00</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#simulate liabilities</span>
<span class="va">liabs</span> <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">4</span> <span class="op">+</span> <span class="va">nsib</span><span class="op">)</span><span class="op">)</span>, 
                      Sigma <span class="op">=</span> <span class="fu"><a href="../reference/get_full_cov.html">get_full_cov</a></span><span class="op">(</span>corr_mat <span class="op">=</span> <span class="va">corr_mat</span>, n_sib <span class="op">=</span> <span class="va">nsib</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Age of children, parents, and siblings</span>
<span class="va">child_age</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">10</span>, <span class="fl">60</span><span class="op">)</span>
<span class="va">father_age</span>  <span class="op">=</span> <span class="va">child_age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">20</span>, <span class="fl">35</span><span class="op">)</span>
<span class="va">mother_age</span>  <span class="op">=</span> <span class="va">child_age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">20</span>, <span class="fl">35</span><span class="op">)</span>
<span class="va">children_sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sibling_sex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="va">nsib</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, size <span class="op">=</span> <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="va">sibling_age</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="va">nsib</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="op">-</span><span class="fl">15</span>, <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="va">child_age</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div id="generating-phen-list" class="section level4">
<h4 class="hasAnchor">
<a href="#generating-phen-list" class="anchor"></a>Generating phen.list</h4>
<p>The input for multiple traits is a slight generalization of the input for a single trait. For each trait the input will be the same, however we will put the input for each trait in a list.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#constructing a list of phenotypes</span>
<span class="va">all_phen</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">corr_mat</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">cur_liabs</span>  <span class="op">=</span> <span class="va">liabs</span><span class="op">[</span><span class="va">i</span>, <span class="op">(</span><span class="fl">4</span> <span class="op">+</span> <span class="va">nsib</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">j</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">4</span> <span class="op">+</span> <span class="va">nsib</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
    <span class="va">id_vec</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">i</span> , <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_f"</span>, <span class="st">"_m"</span><span class="op">)</span><span class="op">)</span>, <span class="kw">if</span><span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_s"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nsib</span><span class="op">)</span> <span class="op">)</span>
    <span class="va">sex_vec</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">children_sex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="kw">if</span><span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">sibling_sex</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span>
    <span class="va">age_vec</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">child_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">father_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">mother_age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="kw">if</span> <span class="op">(</span><span class="va">nsib</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">sibling_age</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span>
    <span class="va">status_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">sex_vec</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ii</span><span class="op">)</span> <span class="op">{</span>
      <span class="op">(</span><span class="va">cur_liabs</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">prev</span><span class="op">[</span><span class="va">sex_vec</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span>, lower.tail <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0L</span>
    <span class="op">}</span><span class="op">)</span>
    <span class="va">aoo_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">id_vec</span><span class="op">)</span><span class="op">)</span>

    <span class="va">cases</span> <span class="op">=</span> <span class="va">status_vec</span> <span class="op">==</span> <span class="fl">1</span>
    <span class="va">aoo_vec</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span> <span class="op">=</span> <span class="fu">LTFHPlus</span><span class="fu">::</span><span class="fu"><a href="../reference/liab_to_aoo.html">liab_to_aoo</a></span><span class="op">(</span>liab <span class="op">=</span> <span class="va">cur_liabs</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span>,
                                           pop_prev <span class="op">=</span> <span class="va">prev</span><span class="op">[</span><span class="va">sex_vec</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">id_vec</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">sex_vec</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">status_vec</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">age_vec</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">aoo_vec</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  
  <span class="va">all_phen</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">tmp</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span>.name_repair <span class="op">=</span> <span class="st">'unique'</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"ids"</span> <span class="op">=</span> <span class="st">"...1"</span>, <span class="st">"sex"</span> <span class="op">=</span> <span class="st">"...2"</span>, <span class="st">"status"</span> <span class="op">=</span> <span class="st">"...3"</span>, <span class="st">"age"</span> <span class="op">=</span> <span class="st">"...4"</span>, <span class="st">"aoo"</span> <span class="op">=</span> <span class="st">"...5"</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">all_phen</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 10,000 x 5
##    ids       sex       status    age       aoo      
##    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  2 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  3 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  4 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  5 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  6 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  7 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  8 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  9 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
## 10 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
## # ... with 9,990 more rows
## 
## [[2]]
## # A tibble: 10,000 x 5
##    ids       sex       status    age       aoo      
##    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  2 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  3 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  4 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  5 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  6 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  7 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  8 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
##  9 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
## 10 &lt;chr [5]&gt; &lt;int [5]&gt; &lt;int [5]&gt; &lt;dbl [5]&gt; &lt;dbl [5]&gt;
## # ... with 9,990 more rows</code></pre>
<p>Where the first row of each disorder is given by</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">all_phen</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> 
  <span class="va">x</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 5 x 5
##   ids     sex status   age   aoo
##   &lt;chr&gt; &lt;int&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1         2      0  27.8    NA
## 2 1_f       1      0  62.1    NA
## 3 1_m       2      0  57.2    NA
## 4 1_s1      2      0  18.2    NA
## 5 1_s2      2      0  16.5    NA
## 
## [[2]]
## # A tibble: 5 x 5
##   ids     sex status   age   aoo
##   &lt;chr&gt; &lt;int&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 1         2      0  27.8    NA
## 2 1_f       1      0  62.1    NA
## 3 1_m       2      0  57.2    NA
## 4 1_s1      2      0  18.2    NA
## 5 1_s2      2      0  16.5    NA</code></pre>
<p>NOTE: The ids, sex and age will be the same across all traits considered. There <em>may</em> be differences in status (and as a result age-of-onset) between disorders.</p>
</div>
<div id="generating-thr-list" class="section level4">
<h4 class="hasAnchor">
<a href="#generating-thr-list" class="anchor"></a>Generating thr.list</h4>
<p>The other input is <strong>thr.list</strong>, which will contain the ids and an upper and lower limit of possible liabilities for each individual.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#calculating threshold for every individual</span>
<span class="va">all_thr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">all_phen</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">phen</span> <span class="op">=</span> <span class="va">all_phen</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="co">#assigning thresholds for each family</span>
  <span class="va">tmp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">phen</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
    <span class="va">ids</span>   <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">ids</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span>
    <span class="va">cases</span> <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">status</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span>
    <span class="va">lower</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span>
    <span class="va">upper</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span> <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">lower</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">upper</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">LTFHPlus</span><span class="fu">::</span><span class="fu"><a href="../reference/age_to_thres.html">age_to_thres</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">aoo</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span>, 
                                                           pop_prev <span class="op">=</span> <span class="va">prev</span><span class="op">[</span><span class="va">phen</span><span class="op">$</span><span class="va">sex</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">cases</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    
    <span class="va">upper</span><span class="op">[</span><span class="op">!</span><span class="va">cases</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">LTFHPlus</span><span class="fu">::</span><span class="fu"><a href="../reference/age_to_thres.html">age_to_thres</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">phen</span><span class="op">$</span><span class="va">age</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">cases</span><span class="op">]</span>,
                                            pop_prev <span class="op">=</span> <span class="va">prev</span><span class="op">[</span><span class="va">phen</span><span class="op">$</span><span class="va">sex</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="va">cases</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">res</span><span class="op">$</span><span class="va">ids</span> <span class="op">=</span> <span class="va">ids</span>
    <span class="va">res</span><span class="op">$</span><span class="va">lower</span> <span class="op">=</span> <span class="va">lower</span>
    <span class="va">res</span><span class="op">$</span><span class="va">upper</span> <span class="op">=</span> <span class="va">upper</span>
<span class="co">#    return(tibble(ids = ids, lower = lower, upper = upper))</span>
    <span class="va">res</span>
  <span class="op">}</span><span class="op">)</span>
  <span class="co">#combining all values into one tibble</span>
  <span class="va">all_thr</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">as_tibble</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">all_thr</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 50,000 x 3
##    ids   lower upper
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1      -Inf  3.39
##  2 1_f    -Inf  1.69
##  3 1_m    -Inf  2.40
##  4 1_s1   -Inf  3.70
##  5 1_s2   -Inf  3.75
##  6 2      -Inf  3.37
##  7 2_f    -Inf  2.58
##  8 2_m    -Inf  2.57
##  9 2_s1   -Inf  3.91
## 10 2_s2   -Inf  3.57
## # ... with 49,990 more rows
## 
## [[2]]
## # A tibble: 50,000 x 3
##    ids   lower upper
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 1      -Inf  3.39
##  2 1_f    -Inf  1.69
##  3 1_m    -Inf  2.40
##  4 1_s1   -Inf  3.70
##  5 1_s2   -Inf  3.75
##  6 2      -Inf  3.37
##  7 2_f    -Inf  2.58
##  8 2_m    -Inf  2.57
##  9 2_s1   -Inf  3.91
## 10 2_s2   -Inf  3.57
## # ... with 49,990 more rows</code></pre>
<p>NOTE: In this simple example the thresholds will be the same across traits for the <em>controls</em>, However the cases have a threshold that depends on the age-of-onset. In real-world data, the thresholds will be different across traits due multiple factors, such as sexes or cohort effects, as well a prevalence differences between traits.</p>
</div>
</div>
<div id="running-lt-fh" class="section level3">
<h3 class="hasAnchor">
<a href="#running-lt-fh" class="anchor"></a>Running LT-FH++</h3>
<p>With all input parameters generated and the correlation matrix for all traits set in the global settings, we have everything we need to run <em>LT-FH++</em> for multiple traits. The package <strong>Future.apply</strong> can be used to parallelize the computations, and we highly recommend doing this, since all modern computers have more than 2 cores available to them. The future framework also allows for easy use on high performance computing (HPC) clusters. In this example, we will utilize 5 threads.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Setting up parallelization backend</span>
<span class="fu">plan</span><span class="op">(</span><span class="fu">tweak</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="va">nthreads</span><span class="op">)</span><span class="op">)</span>
<span class="co">#performs LT-FH++ analysis</span>

<span class="co">#performing the LT-FH++ analysis</span>
<span class="va">multi</span> <span class="op">=</span> <span class="fu"><a href="../reference/estimate_gen_liability_multi_trait.html">estimate_gen_liability_multi_trait</a></span><span class="op">(</span>corr.mat <span class="op">=</span> <span class="va">corr_mat</span>,
                                           phen.list <span class="op">=</span> <span class="va">all_phen</span>,
                                           thr.list <span class="op">=</span> <span class="va">all_thr</span><span class="op">)</span>
<span class="va">multi</span></code></pre></div>
<pre><code>## # A tibble: 10,000 x 3
##    IID   post_gen_liab post_gen_liab_se
##    &lt;chr&gt;         &lt;dbl&gt;            &lt;dbl&gt;
##  1 1           -0.0445          0.00453
##  2 2           -0.0168          0.00476
##  3 3           -0.118           0.00376
##  4 4            1.12            0.00209
##  5 5            0.250           0.00359
##  6 6            0.320           0.00407
##  7 7           -0.0894          0.00422
##  8 8            0.154           0.00410
##  9 9           -0.0936          0.00434
## 10 10          -0.0798          0.00422
## # ... with 9,990 more rows</code></pre>
<p>NOTE: The output of the multi trait analysis is for the first phenotype provided in the list, i.e. the one accessed with “phen.list[[1]]”. Results for the other phenotypes provided is currently only available by rerunning the analysis and rearranging the order of the phenotypes.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Emil Michael Pedersen, Florian Privé.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
